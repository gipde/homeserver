// vim: set filetype=cpp:

#include "Ds18x20libTest.h"

extern "C" {
#include "../../main/ds18x20lib.h"
#include "../../main/ds18x20lib_hw.h"
#include "../../main/delay.h"
}

CASE(Ds18x20LibTest, TestBase)

static one_wire_T ow;
static replay_T replay;

SETUP()
{
    ow = { M_PORTA, M_PINA, M_DDRA, 4};
    initMock();
}

TEST(reset_test)
{
    debug("Reset Test");

    char rdat[] = {0x02};
    replay = { rdat, 1 };
    set_replay_data(&replay);

    reset(&ow);

    char r[] = {0xed, 0x44, 0x7b, 0xab, 0x70, 0xa5, 0x4b, 0x86, 0xa3, 0x1b, 0xfe, 0x8e, 0x74, 0xe6, 0xee, 0x10, 0x79, 0x96, 0xb7, 0xcd};
    return cmpMock(r);
}

TEST(search_test)
{
    char rdat[] = {0x02};
    replay = { rdat, 1 };
    set_replay_data(&replay);

    sensorT sensor;
    search_slaves(&ow, &sensor);

    char r[] = {0x6e, 0xce, 0x39, 0x54, 0x61, 0x72, 0x12, 0xb0, 0xec, 0xb1, 0xe0, 0xce, 0x32, 0xf2, 0xbb, 0x50, 0xb5, 0x69, 0x55, 0xf6};
    return cmpMock(r);
}

